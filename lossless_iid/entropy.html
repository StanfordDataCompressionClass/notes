<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Entropy and Neg-log likelihood thumb rule</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../././mdbook-admonish.css">
        <link rel="stylesheet" href=".././mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../contents.html">EE274: Data Compression, course notes</a></li><li class="chapter-item expanded "><a href="../lossless_iid/coverpage.html"><strong aria-hidden="true">1.</strong> Lossless data compression: basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lossless_iid/intro.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../lossless_iid/prefix_free_codes.html"><strong aria-hidden="true">1.2.</strong> Prefix Free Codes</a></li><li class="chapter-item expanded "><a href="../lossless_iid/kraft_ineq_and_optimality.html"><strong aria-hidden="true">1.3.</strong> Kraft Inequality</a></li><li class="chapter-item expanded "><a href="../lossless_iid/entropy.html" class="active"><strong aria-hidden="true">1.4.</strong> Entropy and Neg-log likelihood thumb rule</a></li><li class="chapter-item expanded "><a href="../lossless_iid/huffman.html"><strong aria-hidden="true">1.5.</strong> Huffman coding</a></li><li class="chapter-item expanded "><a href="../lossless_iid/aep.html"><strong aria-hidden="true">1.6.</strong> Asymptotic Equipartition Property</a></li><li class="chapter-item expanded "><a href="../lossless_iid/arithmetic_coding.html"><strong aria-hidden="true">1.7.</strong> Arithmetic coding</a></li><li class="chapter-item expanded "><a href="../lossless_iid/ans.html"><strong aria-hidden="true">1.8.</strong> Asymmetric Numeral Systems</a></li><li class="chapter-item expanded "><a href="../lossless_iid/non_iid_sources.html"><strong aria-hidden="true">1.9.</strong> Non IID Sources and Entropy Rate</a></li><li class="chapter-item expanded "><a href="../lossless_iid/context_based_coding.html"><strong aria-hidden="true">1.10.</strong> Context-based coding</a></li><li class="chapter-item expanded "><a href="../lossless_iid/lz77.html"><strong aria-hidden="true">1.11.</strong> Universal Compression with LZ77</a></li><li class="chapter-item expanded "><a href="../lossless_iid/practical_tips.html"><strong aria-hidden="true">1.12.</strong> Practical Tips on Lossless Compression</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../lossy/coverpage.html"><strong aria-hidden="true">2.</strong> Lossy data Compression</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lossy/quant.html"><strong aria-hidden="true">2.1.</strong> Basics and Quantization</a></li><li class="chapter-item expanded "><a href="../lossy/rd.html"><strong aria-hidden="true">2.2.</strong> Rate-Distortion Theory</a></li><li class="chapter-item expanded "><a href="../lossy/transform_coding_theory.html"><strong aria-hidden="true">2.3.</strong> Transform Coding Theory</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../resources.html"><strong aria-hidden="true">3.</strong> Resources</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded "><a href="../homeworks/coverpage.html"><strong aria-hidden="true">4.</strong> Homeworks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../homeworks/HW1.html"><strong aria-hidden="true">4.1.</strong> HW1</a></li><li class="chapter-item expanded "><a href="../homeworks/HW1_sol.html"><strong aria-hidden="true">4.2.</strong> HW1 Solution</a></li><li class="chapter-item expanded "><a href="../homeworks/HW2.html"><strong aria-hidden="true">4.3.</strong> HW2</a></li><li class="chapter-item expanded "><a href="../homeworks/HW2_sol.html"><strong aria-hidden="true">4.4.</strong> HW2 Solution</a></li><li class="chapter-item expanded "><a href="../homeworks/HW3.html"><strong aria-hidden="true">4.5.</strong> HW3</a></li><li class="chapter-item expanded "><a href="../homeworks/HW3_sol.html"><strong aria-hidden="true">4.6.</strong> HW3 Solution</a></li><li class="chapter-item expanded "><a href="../homeworks/HW4.html"><strong aria-hidden="true">4.7.</strong> HW4</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../projects.html"><strong aria-hidden="true">5.</strong> Project</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded "><a href="../scl_tutorial/SCL_tutorial.html"><strong aria-hidden="true">6.</strong> SCL Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scl_tutorial/basics.html"><strong aria-hidden="true">6.1.</strong> SCL Basics</a></li><li class="chapter-item expanded "><a href="../scl_tutorial/exercise.html"><strong aria-hidden="true">6.2.</strong> SCL Exercise</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../quiz_problems_2023.html"><strong aria-hidden="true">7.</strong> Quiz Problems (2023)</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="entropy--neg-log-likelihood-thumb-rule"><a class="header" href="#entropy--neg-log-likelihood-thumb-rule">Entropy &amp; Neg-log likelihood thumb rule</a></h1>
<p>In this lecture, our goal is to understand where the thumb rule  $l_{optimal}(symbol) \approx \log_2 \frac{1}{p(symbol)}$ for prefix-free code-lengths came from. To understand this, we are going to take a brief detour and get a sneak-peek into the area of Information Theory.</p>
<p>Information theory is the <em>science of information</em>, and is an area which tries to understand the fundamental nature of what is <em>information</em>, how do we store it, how do we communicate it etc. The whole field (along with some of the most fundamental results in the field) was laid down in a single seminal paper <a href="https://people.math.harvard.edu/~ctm/home/text/others/shannon/entropy/entropy.pdf">A Mathematical theory of Communication</a> by Claude Shannon in 1948.</p>
<p>Rather than talking about information in philosophical terms, we are going to understand information theory mathematically. We are going to first define some quantities and properties central to information theory. As we will see, understanding the mathematical properties of these quantities is what will lead us to the <em>intuition</em> and understanding of information theory.</p>
<h2 id="entropy"><a class="header" href="#entropy">Entropy</a></h2>
<p>So, lets get started: the first property, or <em>information-theoretic measure</em> we are going to define is the <em>Entropy</em>. The entropy, although a term overloaded with a lot of meaning in the (math/science) pop culture, has a precise definition in information theory.</p>
<div id="admonition-entropy" class="admonition admonish-note" role="note" aria-labelledby="admonition-entropy-title">
<div class="admonition-title">
<div id="admonition-entropy-title">
<p>Entropy</p>
</div>
<a class="admonition-anchor-link" href="#admonition-entropy"></a>
</div>
<div>
<p>Let $X$ be a random variable, with alphabet ${1, 2, \ldots, k}$ and discrete probability distribution $P = { p_1, p_2, \ldots, p_k}$. i.e. one can imagine the samples generate by the random variable $X$ to be independent and identically distributed as per distribution $P$.</p>
<p>Then the entropy $H(X)$ of the random variable is defined as:</p>
<p>$$ H(X) = \sum_{i=1}^k p_i \log_2 \frac{1}{p_i} $$</p>
</div>
</div>
<p>Some comments:</p>
<ul>
<li>As you can see, $H(X)$ is a simple function of the distribution $P$. So, some works also denote $H(X)$ as a $H(P)$. We will use both of these notations interchangeably; but note that that the $H(X)$ notation is more precise and will be more helpful when we deal with more complex distributions (like Markov distributions).</li>
<li>Another way to look at $H(X)$ is as expectation over the negative-log likelihood function $NLL(X) = \log_2 \frac{1}{P(X)}$
$$
\begin{aligned}
H(X) &amp;= \mathbb{E}_P\left[ NLL(X) \right] \
H(X) &amp;= \mathbb{E}<em>P\left[ \log_2 \frac{1}{P(X)} \right] \
&amp;= \sum</em>{i=1}^k p_i \log_2 \frac{1}{p_i} \
\end{aligned}
$$
Although, this feels a bit weird, the neg-log likelihood function is a completely legitimate function of the random variable $X$. All the different viewpoints are useful in different scenarios</li>
</ul>
<h2 id="properties-of-entropy"><a class="header" href="#properties-of-entropy">Properties of Entropy</a></h2>
<p>Now that we have defined <em>Entropy</em>, lets take a look at some properties of $H(X)$. To prove most of these properties, we are going to need a simple but a very profound property of convex functions: the <em>Jensen's inequality</em>.</p>
<h3 id="jensens-inequality"><a class="header" href="#jensens-inequality">Jensen's inequality</a></h3>
<div id="admonition-jensens-inequality" class="admonition admonish-note" role="note" aria-labelledby="admonition-jensens-inequality-title">
<div class="admonition-title">
<div id="admonition-jensens-inequality-title">
<p>Jensen's inequality</p>
</div>
<a class="admonition-anchor-link" href="#admonition-jensens-inequality"></a>
</div>
<div>
<p>Let $f(x)$ be a convex function. Let $X$ be a random variable on ${1, 2, \ldots, k}$ with discrete probability distribution $P = {p_1, p_2, \ldots, p_k}$ be some probability distribution. Then:
$$
\mathbb{E} [f(X)] \geq f(\mathbb{E}[X])
$$</p>
<p>Similarly if $g(X)$ is a concave function, then the reverse inequality is true:
$$
\mathbb{E} [g(X)] \leq g(\mathbb{E}[X])
$$</p>
<p>In both cases, equality holds iff (if and only if) $x_1 = x_2 = \ldots = x_k$</p>
</div>
</div>
The Jensen's inequality can be also understood succinctly using the figure below. for clarity lets assume that $X$ takes values in $\{x_1, x_2\}$. 
<p><img src="images/jensen.svg" alt="Jensen&#39;s inequality" /></p>
<ul>
<li>If one looks at the LHS: $ \mathbb{E} [f(X)] = p_1 f(x_1) + p_2f(x_2) $, then it can be understood as simply a weighted average with weights $p_1, p_2$ over the points $f(x_1), f(x_2)$. This weighted average corresponds to a point somewhere on the segment joining points $f(x_1)$ and $f(x_2)$</li>
<li>If one looks at the RHS: $f(\mathbb{E}[X]) = f(p_1x_1 + p_2x_2)$. Thus, the RHS corresponds to the value of the convex function $f$ at the weighted averaged point $p_1x_1 + p_2x_2$. It is clear from the figure that because of the "bowl-shaped* nature of $f$, $\mathbb{E} [f(X)] \geq f(\mathbb{E}[X])$.</li>
<li>It is also clear from the figure why the equality condition holds true iff $x_1 = x_2$</li>
</ul>
<p>We won't prove the Jensen's inequality here, but it is useful to understand and visualize the inequality. For a rigorous proof look at <a href="https://en.wikipedia.org/wiki/Jensen%27s_inequality">the wiki article on Jensen's Inequality</a>. In the simple discrete case, it can be proved using induction.</p>
<p>Okay, we are all set to look at some properties of <em>Entropy</em>. As you can guess, in our case, we will be specifically using Jensen's inequality on the concave function $\log_2(.)$.</p>
<h4 id="1-non-negativity-of-entropy-hx-geq-0"><a class="header" href="#1-non-negativity-of-entropy-hx-geq-0"><strong>1. Non-negativity of Entropy: $H(X) \geq 0$</strong>:</a></h4>
<p>It is easy to see that $H(X) \geq 0$. The reason is that: $\log_2 \frac{1}{p_i} \geq 0$, as $0 \leq p_i \leq 1$
$$
\begin{aligned}
H(X) &amp;= \sum_{i=1}^k p_i \log_2 \frac{1}{p_i} \
&amp;\geq  \sum_{i=1}^k p_i \times 0 \
&amp;= 0
\end{aligned}
$$</p>
<h4 id="2-upper-bound-on-entropy-hx-leq-log_2-k"><a class="header" href="#2-upper-bound-on-entropy-hx-leq-log_2-k"><strong>2. Upper bound on Entropy: $H(X) \leq log_2 k$</strong>:</a></h4>
<p>We know that $H(X) \geq 0$. We can also compute an upper bound on $H(X)$:
$$
\begin{aligned}
H(X) &amp;= \mathbb{E}_P \log_2 \frac{1}{p(X)} \
&amp;\leq \log_2 \mathbb{E}<em>P \frac{1}{p(X)} \
&amp;= \log_2 \sum</em>{i=1}^k p_i * \frac{1}{p_i} \
&amp;= \log_2 k
\end{aligned}
$$
The first step of the proof follows from Jensen's inequality for the Concave function $\log_2(.)$. Also, note that the equality $H(X) = \log_2 k$ is possible only if: $$ \log_2 \frac{1}{p_1} = \log_2 \frac{1}{p_2} = \ldots = \log_2 \frac{1}{p_k}$$
which implies that $$p_1=p_2=\ldots=p_k \iff H(X) = \log_2 k $$</p>
<h4 id="3-joint-entropy-of-independent-random-variables"><a class="header" href="#3-joint-entropy-of-independent-random-variables"><strong>3. Joint entropy of independent random variables</strong>:</a></h4>
<p>If we have random variables $X_1, X_2$, we can define their entropy simply as the entropy of the pair $(X_1,X_2)$. The joint entropy is denoted
as $H(X_1, X_2)$ and can be expanded as
$$H(X_1, X_2) = \sum_{x_1, x_2} P(X_1=x_1, X_2=x_2) \log_2 \frac{1}{P(X_1=x_1, X_2=x_2)}$$</p>
<p>Now if $X_1$ and $X_2$ are independent random variables, then we have
$$
\begin{align}
H(X_1, X_2) &amp;= \sum_{x_1, x_2} P(X_1=x_1, X_2=x_2) \log_2 \frac{1}{P(X_1=x_1, X_2=x_2)}\
&amp;= \sum_{x_1, x_2} P(X_1=x_1) P(X_2=x_2) \log_2 \frac{1}{P(X_1=x_1) P(X_2=x_2)}\
&amp;= \sum_{x_1, x_2} P(X_1=x_1) P(X_2=x_2) \log_2 \frac{1}{P(X_1=x_1)} + \sum_{x_1, x_2} P(X_1=x_1) P(X_2=x_2) \log_2 \frac{1}{P(X_2=x_2)}\
&amp;= \sum_{x_1} P(X_1=x_1)  \log_2 \frac{1}{P(X_1=x_1)} \sum_{x_2}P(X_2=x_2) + \sum_{x_2}P(X_2=x_2) \log_2 \frac{1}{P(X_2=x_2)}\sum_{x_1}P(X_1=x_1) \
&amp;= \sum_{x_1} P(X_1=x_1)  \log_2 \frac{1}{P(X_1=x_1)}+ \sum_{x_2}P(X_2=x_2) \log_2 \frac{1}{P(X_2=x_2)}\
&amp;= H(X_1) + H(X_2)\
\end{align}
$$</p>
<p>Thus, the joint entropy of independent random variables is simply the sum of their individual entropies. This generalizes to $n$ independent random variables using induction. In particular, if the $n$-tuple $X^n = (X_1,\dots,X_n)$ consists of i.i.d. random variables distributed like $X$, then $H(X^n) = nH(X)$. The general case of dependent random variables and their joint entropy is studied in a later chapter.</p>
<h4 id="4-entropy-as-a-lower-bound--hx-leq-mathbbe_p-log_2-frac1qx--for-any-distribution-qx"><a class="header" href="#4-entropy-as-a-lower-bound--hx-leq-mathbbe_p-log_2-frac1qx--for-any-distribution-qx"><strong>4. Entropy as a lower bound: $ H(X) \leq \mathbb{E}_P \log_2 \frac{1}{q(X)} $ for any distribution $q(X)$:</strong></a></h4>
<p>Let us spell out this property in a bit more detail. Given any probability distribution $q(X)$, the following is true: $$  H(X) \leq \mathbb{E}_P \log_2 \frac{1}{q(X)} $$ the equality holds iff $q(X) = p(X)$, i.e. we want to show that
$$
\begin{aligned}
0 &amp;\leq \mathbb{E}_P \log_2 \frac{1}{q(X)} - H(X)\
&amp;= \mathbb{E}_P \log_2 \frac{1}{q(X)} - \mathbb{E}_P \log_2 \frac{1}{p(X)}\
&amp;= \mathbb{E}_P \log_2 \frac{p(X)}{q(X)}
\end{aligned}
$$
Okay, so proving the lower bound property is equivalent to showing that $\mathbb{E}_P \log_2 \frac{p(X)}{q(X)} \geq 0$. Any idea how can we do this?</p>
<p>The idea is again to use <em>Jensen's inequality</em>:</p>
<p>$$
\begin{aligned}
\mathbb{E}_P \log_2 \frac{p(X)}{q(X)} &amp;= - \mathbb{E}<em>P \log_2 \frac{q(X)}{p(X)} \
&amp;\geq - \log_2 \mathbb{E}<em>P \frac{q(X)}{p(X)} \
&amp;\geq - \log_2 \sum</em>{i=1}^k p_i * \frac{q_i}{p_i} \
&amp;\geq - \log_2 \sum</em>{i=1}^k q_i \
&amp;\geq - \log_2 1 \
&amp;= 0
\end{aligned}
$$</p>
<p>Note that we used <em>Jensen's inequality</em> in step (2), but the sign of the inequality is reversed because of the negation.
We also know that equality holds iff
$$
\frac{q_1}{p_1} = \frac{q_2}{p_2} = \ldots  = \frac{q_k}{p_k}
$$
i.e. if $q(X) = p(X)$!</p>
<p>Alright! This proves our property as
$$ \mathbb{E}_P \log_2 \frac{q(X)}{p(X)} \geq 0 \rightarrow H(X) \leq \mathbb{E}_P \log_2 \frac{1}{q(X)} $$</p>
<p>Let's pause a bit and think about what this property is telling:</p>
<ul>
<li>Essentially we are telling that $H(X)$ is the solution to the minimization problem:
$$ H(X) = \min_{q(X)} \mathbb{E}_P \log_2 \frac{1}{q(X)}  $$
We will see that this characterization is often quite useful.</li>
<li>Another corollary we proved is that $$ \mathbb{E}<em>P \log_2 \frac{q(X)}{p(X)} = \sum</em>{i=1}^k p_i \log_2 \frac{p_i}{q_i} \geq 0 $$
for any two distributions $p, q$. The quantity on the right is also known as the <em>KL-Divergence</em> $D_{KL}(p||q)$ between the two distributions.</li>
</ul>
<div id="admonition-kl-divergence" class="admonition admonish-example" role="note" aria-labelledby="admonition-kl-divergence-title">
<div class="admonition-title">
<div id="admonition-kl-divergence-title">
<p>KL-Divergence</p>
</div>
<a class="admonition-anchor-link" href="#admonition-kl-divergence"></a>
</div>
<div>
<p>Let $P = { p_1, p_2, \ldots, p_k}$ and $Q = { q_1, q_2, \ldots, q_k}$ be two given probability distributions. Then the KL-Divergence is defined as:</p>
<p>$$ D_{KL}(p||q) = \sum_{i=k} p_i \log_2 \frac{p_i}{q_i} $$</p>
<p>The following property holds for $D_{KL}(p||q)$:</p>
<p>$$ D_{KL}(p||q) \geq 0$$</p>
<p>Equality holds iff $p=q$</p>
</div>
</div>
<p>The KL-Divergence is a very important information theoretic quantity, which we will revisit!</p>
<hr />
<p>Okay, now that we have defined and got a bit familiar with some of the information theoretic measures, we are all set to understand where the thumb rule  $l_{optimal}(symbol) \approx \log_2 \frac{1}{p(symbol)}$ comes from!</p>
<p>To do so, let's try to answer the question:</p>
<div id="admonition-question-optimal-prefix-free-code" class="admonition admonish-question" role="note" aria-labelledby="admonition-question-optimal-prefix-free-code-title">
<div class="admonition-title">
<div id="admonition-question-optimal-prefix-free-code-title">
<p>Question: Optimal prefix-free code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-question-optimal-prefix-free-code"></a>
</div>
<div>
<p>Given a probability distribution $p_1, p_2, \ldots, p_k$,</p>
<ol>
<li>What is the optimal prefix-free code for this distribution?</li>
<li>What is the best compression it can achieve?</li>
</ol>
</div>
</div>
<h2 id="optimal-prefix-free-codes"><a class="header" href="#optimal-prefix-free-codes">Optimal prefix-free codes</a></h2>
<p>The question seems quite daunting! How can we even go about approaching this one? The space of all prefix-free codes is quite large, and not very structured.</p>
<p>Luckily, based on the converse of Kraft's inequality, we know that the space of all prefix-free codes can be characterized by the inequality:</p>
<p>$$ \sum_{i=1}^k 2^{-l_i} \leq 1$$
where $l_i$ represent the code-lengths (i.e the depths of the nodes in the prefix-free tree)</p>
<p>Thus, the problem of finding the <em>optimal prefix-free code</em> given a probability distribution $p_1, p_2, \ldots, p_k$ can be formulated as a concise optimization problem.</p>
<div id="admonition-optimal-prefix-free-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-optimal-prefix-free-code-title">
<div class="admonition-title">
<div id="admonition-optimal-prefix-free-code-title">
<p>Optimal prefix-free code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-optimal-prefix-free-code"></a>
</div>
<div>
<p>The problem of finding <em>optimal prefix-free code</em> given a probability distribution $p_1, p_2, \ldots, p_k$ can be formulated as:</p>
<p>Given probabilities $p_1, p_2, \ldots, p_k$, solve for code-lengths $l_i \in \mathbb{N}$, such that:
$$ \begin{aligned}
\text{minimize   } &amp;\sum_{i=1}^k p_i l_i \
\text{under the constraint } &amp;\sum_{i=1}^k 2^{-l_i} \leq 1
\end{aligned} $$</p>
</div>
</div>
<p>Quite elegant! We have disassociated the problem of finding optimal prefix-free codes from unclear search spaces over trees and so on. Instead, we now just have this concrete optimization problem. Unfortunately we have integers $l_i$ to optimize over; and integer optimization problems might not be a feasible problem in general. In this case however, we can indeed solve this problem! We will look at a solution in the next lecture.</p>
<p>For this lecture, our goal is to see what best average compression performance we can achieve, i.e what is the solution (or a lower bound) to the minimization objective $\sum_{i=1}^k p_i l_i = \mathbb{E}_P [L]$</p>
<h3 id="lower-bounding-the-average-codelength"><a class="header" href="#lower-bounding-the-average-codelength">Lower bounding the average codelength</a></h3>
<p>Okay, lets try to see how we can obtain a lower bound for $\sum_{i=1}^k p_i l_i$, given the constraint that $\sum_{i=1}^k 2^{-l_i} \leq 1$.</p>
<p>Let's start by adding a <em>dummy</em> length $l_{k+1}$, so that:
$$ \sum_{i=1}^{k+1} 2^{-l_i} = 1$$
The benefit of this formulation is that we can now imagine $2^{-l_i} = q_i$ as probability values, and use the plethora of properties we proved earlier! Note that $l_{k+1}$ might not be an integer, but that is okay.</p>
<p>Let's also define $p_{k+1} = 0$, so that the new objective is equal to the average codelength.</p>
<p>$$ \mathbb{E}<em>P [L] = \sum</em>{i=1}^k p_i l_i = \sum_{i=1}^{k+1} p_i l_i $$</p>
<p>Okay, now that we have the setup ready, let us try to analyze the average codelength:</p>
<p>$$
\begin{aligned}
\sum_{i=1}^{k+1} p_i l_i   &amp;= \sum_{i=1}^{k+1} p_i \log_2  2^{l_i}\</p>
<p>&amp;= \sum_{i=1}^{k+1} p_i \log_2 \frac{1}{2^{-l_i}} \
&amp;= \sum_{i=1}^{k+1} p_i \log_2 \frac{1}{q_i} \
\end{aligned}
$$</p>
<p>All we have done until now is some basic math yoga, but the outcome is that we have transformed the objective $\sum_{i=1}^{k+1} p_i l_i$ into a form more amenable for our purpose. Do you now see the lower bound?</p>
<p>Using the <strong>property 3</strong> of entropy for distribution $P$ and $Q$ proved above, we can now show that:</p>
<p>$$
\begin{aligned}
\sum_{i=1}^{k+1} p_i l_i  &amp;= \sum_{i=1}^{k+1} p_i \log_2 \frac{1}{2^{-l_i}} \
&amp;= \sum_{i=1}^{k+1} p_i \log_2 \frac{1}{q_i} \
&amp;\geq \sum_{i=1}^{k+1} p_i \log_2 \frac{1}{p_i}  \
&amp;=  \sum_{i=1}^{k} p_i \log_2 \frac{1}{p_i}  \
&amp;= H(X)
\end{aligned}
$$</p>
<p><strong>Thus, the lower bound on average codelength of any prefix-free code is the Entropy $H(X)$!</strong> It is also easy to see that the equality holds if and only if:
$p_i = q_i = 2^{-l_i}$ for all $i \in {1, 2, \ldots, k}$.</p>
<p>To summarize the important theorem:</p>
<div id="admonition-theorem-3-entropy-as-a-lower-bound-on-avg-codelength" class="admonition admonish-example" role="note" aria-labelledby="admonition-theorem-3-entropy-as-a-lower-bound-on-avg-codelength-title">
<div class="admonition-title">
<div id="admonition-theorem-3-entropy-as-a-lower-bound-on-avg-codelength-title">
<p>Theorem-3: Entropy as a lower bound on avg. codelength</p>
</div>
<a class="admonition-anchor-link" href="#admonition-theorem-3-entropy-as-a-lower-bound-on-avg-codelength"></a>
</div>
<div>
<p>Given a distribution $p_1, p_2, ..., p_k$ for data. Any prefix-free code with code-lengths $l_1, l_2, \ldots, l_k$ will have average codelength lower bounded by the entropy $H(X)$ of the source distribution $P$:</p>
<p>$$
\begin{aligned}
\sum_{i=1}^{k} p_i l_i<br />
&amp;\geq  \sum_{i=1}^{k} p_i \log_2 \frac{1}{p_i}  \
&amp;= H(X)
\end{aligned}
$$</p>
<p>The equality holds if and only if:
$p_i = 2^{-l_i}$ for all $i \in {1, 2, \ldots, k}$, i.e:</p>
<p>$$ l_i = \log_2 \frac{1}{p_i} $$</p>
</div>
</div>
<p>Some observations/comments:</p>
<h4 id="1-thumb-rule-justification"><a class="header" href="#1-thumb-rule-justification"><strong>1. Thumb-rule justification</strong></a></h4>
<p>Notice that the equality condition tells us that optimal compression can be achieved by the prefix-free code iff:</p>
<p>$$ l_i = \log_2 \frac{1}{p_i} $$</p>
<p>and, this is the justification for the thumb rule $l_{optimal}(symbol) \approx \log_2 \frac{1}{p(symbol)}$, we discussed in the previous lecture and used for construction of Shannon code.</p>
<h4 id="2-shannon-code-performance"><a class="header" href="#2-shannon-code-performance"><strong>2. Shannon code performance</strong></a></h4>
<p>Another point to note is that, we can never achieve avg codelength equal to entropy $H(X)$, unless $p_i = 2^{-l_i}$, i.e. all the probabilities $p_i$ are powers of $2$. This can be quite unlikely in real life, which is a bit of a bummer.</p>
<p>The positive news is that we can in fact get quite close to $H(X)$.</p>
<p>Let's analyze the performance of Shannon code. We know that Shannon code has code-lengths $l_i = \left\lceil \log_2 \frac{1}{p_i} \right\rceil$, thus the average codelength is:</p>
<p>$$
\begin{aligned}
\sum_{i=1}^{k} p_i l_i<br />
&amp;\leq  \sum_{i=1}^{k} p_i  \left\lceil \log_2 \frac{1}{p_i} \right\rceil \
&amp;\leq \sum_{i=1}^{k} p_i  ( \log_2 \frac{1}{p_i} + 1 ) \
&amp;= \sum_{i=1}^{k} p_i  \log_2 \frac{1}{p_i} + 1 \
&amp;= H(X) + 1
\end{aligned}
$$</p>
<p>Thus, Shannon code guarantees that we can always achieve average code-lengths within $1$ bit of the optimal. This is quite promising!</p>
<p>Essentially, unless the entropy $H(X)$ is very low, we are not missing much by using Shannon codes.</p>
<h4 id="3-coding-in-blocks"><a class="header" href="#3-coding-in-blocks"><strong>3. Coding in blocks</strong></a></h4>
<p>As discussed above Shannon codes only guarantee performance up to 1 bit of entropy, and this gap is too much in some scenarios, especially with highly compressible data. In such cases, one common strategy is to code in blocks. This simply means we can treat an input $n$-tuple $X^n = (X_1,\dots,X_n)$ as a symbol in a bigger alphabet, and apply Shannon code to this alphabet. So we split the input stream into blocks of size $n$ symbols, encode each block and concatenate the results. Here again, Shannon codes get us to within 1 bit of entropy and hence we have (denoting the expected code length by $\bar{l}$):
$$\bar{l}(X^n) \leq H(X^n) + 1$$</p>
<p>Using the properties of joint entropy for i.i.d. random variables, and dividing by $n$ we get
$$\frac{1}{n}\bar{l}(X^n) \leq H(X) + \frac{1}{n}$$
which means coding in blocks of $n$ brings us within $\frac{1}{n}$ bits of entropy. This means we can get arbitrary close to entropy using block coding and hence entropy is not only the lower bound, but it is also achievable. In the next chapter, we will look at some examples of this phenomenon where we'll see how the average code length improves as we code with bigger and bigger blocks. But there is no free lunch with block coding! Note that a naive implementation would lead to a complexity exponential in $n$ as if the alphabet size is $k$ per-symbol, with block-coding the number of symbols in the alphabet an encoder needs to handle expands to a size of $k^n$. Moreover, we now have a decoding delay of $n$ since we cannot just go and decode a single symbol until we get the entire block. In later chapters, we will look at clever implementations that successfully get the benefits of block coding while reducing this penalty.</p>
<h4 id="4-entropy-as-a-lower-bound-for-uniquely-decodable-codes"><a class="header" href="#4-entropy-as-a-lower-bound-for-uniquely-decodable-codes"><strong>4. Entropy as a lower bound for uniquely decodable codes</strong></a></h4>
<p>We showed that $H(X)$ lower bounds the average code-lengths for prefix-free codes. But, what about general symbol codes which are uniquely decodable (or <em>lossless</em>)?</p>
<p>We saw that even for general uniquely decodable symbol codes, the Kraft inequality holds true. i.e:
$$ \sum_{i=1}^k 2^{-l_i} \leq 1$$
Notice that this is precisely the only property we use for proving the lower bound on $H(X)$, and so, entropy is in fact a lower bound on average code-lengths for general uniquely decodable codes.</p>
<h4 id="5-mismatched-coding-and-kl-divergence"><a class="header" href="#5-mismatched-coding-and-kl-divergence"><strong>5. Mismatched coding and KL-divergence</strong></a></h4>
<p>We saw above that the code optimized of a source $P$ will have code lengths $l_i \approx \log_2 \frac{1}{p_i}$. This achieves expected code length close to entropy:
$$\bar{l} = \sum p_i l_i \approx \sum p_i  \log_2 \frac{1}{p_i} = H(P)$$</p>
<p>Now, consider a scenario where we optimize a code for source distribution $Q$ but then use it for a source with distribution $P$. In this case, the code lengths will be  $l_i \approx \log_2 \frac{1}{q_i}$ and the average code length will be
$$
\begin{align}
\bar{l} &amp;= \sum p_i l_i \
&amp;\approx \sum p_i  \log_2 \frac{1}{q_i} \
&amp;= \sum p_i  \log_2 \frac{1}{p_i} + \sum p_i  \log_2 \frac{p_i}{q_i} \
&amp;= H(P) + D(P||Q)
\end{align}
$$
In this scenario, the optimal code length was $H(P)$ but the actual average code length exceeds it by $D(P||Q)$. Thus the KL-divergence is the penalty for mismatched coding for using the incorrect distribution for designing the code. Later in the class we will study universal codes which imply existence of distributions that can closely approximate any distribution from a large class, meaning that a single code (over a block) is able to perform well irrespective of the actual source distribution.</p>
<h2 id="entropy-beyond-data-compression"><a class="header" href="#entropy-beyond-data-compression">Entropy beyond data compression</a></h2>
<p>Given a random variable $X$ over ${1, 2, \ldots, k}$ with distribution $P = { p_1, p_2, \ldots, p_k }$, we know that the fundamental limit on compression of the random variable $X$ using symbol codes is $H(X)$.</p>
<p>$H(X)$ is sometimes also referred to as the self-information of the random variable $X$, as in a way, we are saying that the amount of information (on an average) in each instantiation of the random variable $X$ is $H(X)$ bits. This is quite natural, as we should not be able to compress an input better than the amount of information it is worth.</p>
<p>The discussion, although a bit hand-wavy is quite fundamental. Due to this, we see $H(X)$ popping up at lots of other places as a fundamental limit of a problem, and not just in case of compression.</p>
<p>For example, here are a few scenarios, for which the answer is related to $H(X)$. Try to solve them for fun!</p>
<p><strong>1. Simulating non-uniform random variables:</strong> Lets say you want to simulate a random variable $X$ over ${1, 2, \ldots k}$ with distribution $P = { p_1, p_2, \ldots, p_k }$. To simulate the random variable, you are only allowed to use fair coin tosses. In that case, what is fundamental limit on the average number of coins you would have to toss to simulate $X$?</p>
<p><strong>2. Simulating a fair coin using a biased coin:</strong> Lets now say you have a biased coin with probability of <code>H/T</code> to be $p, 1-p$ respectively. The goal is to use this coin to simulate a fair coin. One simple way to do this is to toss the coin twice, and associate <code>(H,T)</code> as heads, and <code>(T,H)</code> as tails. If we get <code>(H,H), (T,T)</code>, then we discard the result and toss again. Is this the optimal strategy though? Can you do better? What is the fundamental limit on the average number of biased coins you would have to toss do to obtain a fair coin?</p>
<p><strong>3. Biased binary search:</strong> We are familiar that given a sorted array of size $k$, we can locate a query $q$ in one of the $n$ bins using $\lceil \log_2 k \rceil$ comparisons. However, a lot of times, we already have a good idea which bins the query might lie in. Can we accelerate the binary-search in this case? To be more precise, lets say you have a bias that the query will lie in each of the bins with probability $p_1, p_2, \ldots, p_k$. (usually this bias is uniform, i.e $p_i = 1/n$). In such a scenario what is the fundamental limit on the average number of comparisons you have to do to locate the query $q$?</p>
<p>Although all these scenarios seem very different, they are essentially related to <em>Entropy</em> $H(X)$, and use the property that the self information, the amount of bits corresponding to random variable $X$ is $H(X)$. This key intuition led to a very diverse and vibrant area of mathematics called <em>Information Theory</em>. What we saw in today's lecture is just a small glimpse into information theory, but if you are interested please take a look at the course <a href="https://web.stanford.edu/class/ee276/">EE 276</a>, and the resources listed there.</p>
<h2 id="summary-and-next-lecture"><a class="header" href="#summary-and-next-lecture">Summary and next lecture</a></h2>
<p>To summarize this lecture:</p>
<ol>
<li><strong>Entropy:</strong> We took a detour into information theory and understood some properties of entropy $H(X)$.</li>
<li><strong>Entropy as a limit of compression:</strong> We derived the properties of $H(X)$ and used them to show that $H(X)$ is the fundamental limit on the compression, i.e. the average codelength of any prefix-free code designed for compressing a given source $X$ is always lower bounded by $H(X)$.</li>
</ol>
<p>Although we were able to show that $H(X)$ is the fundamental limit on average codelength, and that we can always come within 1 bit of the fundamental limit using Shannon codes, it is a bit unsatisfactory as we don't know if Shannon Code is the optimal prefix code.</p>
<p>In the next lecture, we are doing to discuss <strong>Huffman Code</strong>, which is the answer to the question:</p>
<blockquote>
<p>Given a random variable with instances sampled i.i.d with probability distribution $P = {p_1, p_2, \ldots, p_k}$, what is the best prefix free code for this source?</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../lossless_iid/kraft_ineq_and_optimality.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../lossless_iid/huffman.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../lossless_iid/kraft_ineq_and_optimality.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../lossless_iid/huffman.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
